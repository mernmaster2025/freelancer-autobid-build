import{u as e,r as s,j as t,c as r,R as a}from"./useStorage.js";import{S as l,l as o}from"./constants.js";function n({showPanelOnPage:r}){const[a]=e("bidding",{}),[n]=e("settings",{}),[i]=e("logs",{}),[c]=e("auth",{}),d=(null==a?void 0:a.status)||l.STOPPED,m=(null==a?void 0:a.sessionBidsCount)||0,x=(null==n?void 0:n.autoBotCount)||0,u=(null==i?void 0:i.unreadCount)||0,p=(null==a?void 0:a.dailyBids)||{count:0,date:(new Date).toDateString()},b=(null==c?void 0:c.profile)||null,f=(null==b?void 0:b.membership)||"basic",h=null==b?void 0:b.membership_expires_at,g=!(("premium"===f||"ultra"===f)&&(!h||new Date(h)<new Date))||"premium"!==f&&"ultra"!==f?f:"basic",w="premium"===g||"ultra"===g,y=(null==b?void 0:b.trial_ends_at)||null,j=(e=>{switch(e){case"basic":default:return 10;case"premium":return 20;case"ultra":return-1}})(g),N=p.date===(new Date).toDateString()?p.count:0,v=-1===j?-1:Math.max(0,j-N),[k,F]=s.useState(!1),[P,$]=s.useState(!1);s.useEffect(()=>{o.log(`Status: ${d}, SessionBids: ${m}, AutoBotCount: ${x}, UnreadLogsCount: ${u}`)},[d,m,x,u]);const C=(e,s={})=>new Promise((t,r)=>{chrome.runtime.sendMessage({action:e,...s},e=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):t(e||{})})}),E=x>0?`${m||0}/${x}`:`${m||0}`,S=x>0||m>0,M=-1!==v&&v>=0,B=d===l.RUNNING,D=(()=>{if(!y)return!1;return new Date(y)<new Date})(),A=w||"basic"===g&&!D,L=[{icon:"fa-robot",label:"Custom AI",panel:"customai",iconColor:"text-green-400",disabled:!A},{icon:"fa-paper-plane",label:"Telegram",panel:"telegram",iconColor:"text-blue-400",disabled:!A},{icon:"fa-comments",label:"Chat",panel:"chat",disabled:!A,iconColor:"text-blue-400"}],O=e=>{const s="logs"===e.panel&&u>0,a=e.iconColor||"text-dark-text";return t.jsxs("button",{onClick:()=>!e.disabled&&r(e.panel),disabled:e.disabled,className:"flex items-center justify-between px-3 py-2 text-xs font-semibold rounded-md border border-dark-border bg-dark-card text-dark-text hover:bg-dark-border hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("i",{className:`fas ${e.icon} ${a}`}),e.label]}),s&&t.jsx("span",{className:"bg-red-500 text-white text-[9px] font-bold rounded-full w-5 h-5 flex items-center justify-center",children:u>99?"99+":u})]},e.panel)};return t.jsx("div",{className:"flex flex-col",children:t.jsxs("div",{className:"flex flex-col gap-3 p-3 bg-dark-bg",children:[t.jsx("div",{className:"flex flex-col gap-1.5 p-2 border border-dark-border rounded-lg bg-dark-card",children:[{icon:"fa-user",label:"Profile",panel:"profile",iconColor:"text-blue-400"},{icon:"fa-folder",label:"Project",panel:"project",iconColor:"text-purple-400"},{icon:"fa-filter",label:"Filters",panel:"filters",iconColor:"text-orange-400"},{icon:"fa-file-alt",label:"Template",panel:"template",iconColor:"text-gray-500"},{icon:"fa-gear",label:"Settings",panel:"settings",iconColor:"text-gray-400"},{icon:"fa-list",label:"Logs",panel:"logs",iconColor:"text-yellow-400"}].map(O)}),t.jsxs("div",{className:"flex flex-col gap-1.5 p-2 border border-dark-border rounded-lg bg-dark-card",children:[t.jsxs("div",{className:"px-2 pb-1.5 border-b border-dark-border mb-1 flex items-center justify-between",children:[t.jsx("h3",{className:"text-xs font-bold text-yellow-400 uppercase tracking-wide",children:"Premium"}),"basic"===f&&y&&t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-[10px] font-semibold text-red-400",children:"Trial - "}),t.jsx("span",{className:"text-[10px] font-semibold "+(D?"text-red-400":"text-green-400"),children:(()=>{if(!y||"basic"!==g)return null;const e=new Date(y)-new Date,s=Math.ceil(e/864e5);if(s<0)return"Trial Expired";if(0===s){const s=Math.ceil(e/36e5);return s>0?`${s}h left`:"Expires today"}return 1===s?"1 day left":`${s} days left`})()})]})]}),L.map(O)]}),t.jsx("div",{className:"border-dark-border",children:B?t.jsxs("button",{onClick:async()=>{$(!0);try{const e=await C("stopBot");if(e&&e.success)o.log("Bot stopped",!0),window.close();else{const s=(null==e?void 0:e.message)||"Failed to stop bot";o.error(s),alert(s)}}catch(e){o.error(`Error stopping bot: ${e.message}`,!0),alert(e.message)}finally{$(!1)}},disabled:P,className:"flex items-center justify-between px-3 py-2 text-xs font-semibold rounded-md bg-red-500 text-white hover:bg-red-600 disabled:opacity-60 disabled:cursor-not-allowed transition-colors w-full",children:[t.jsx("span",{className:"flex items-center gap-2",children:P?t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-spinner fa-spin"}),"Stopping..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fas fa-stop"}),"Stop Bot"]})}),t.jsxs("span",{className:"flex items-center gap-1",children:[S&&t.jsx("span",{className:"bg-yellow-400 text-gray-900 text-[9px] font-bold px-1.5 py-0.5 rounded-full min-w-[16px] text-center shadow-sm",children:E}),M&&t.jsx("span",{className:"bg-red-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-full min-w-[16px] text-center shadow-sm",children:v})]})]}):t.jsxs("button",{onClick:async()=>{F(!0),o.log("Starting bot...");try{const e=await C("startBot");if(e&&e.success)o.success("Bot started successfully!",!0),window.close();else{const s=(null==e?void 0:e.message)||"Failed to start bot";o.error(s),alert(s)}}catch(e){o.error(`Error starting bot: ${e.message}`,!0),alert(e.message)}finally{F(!1)}},disabled:k,className:"flex items-center justify-between px-3 py-2 text-xs font-semibold rounded-md bg-green-500 text-white hover:bg-green-600 disabled:opacity-60 disabled:cursor-not-allowed transition-colors w-full",children:[t.jsxs("span",{className:"flex items-center gap-2",children:[t.jsx("i",{className:"fas fa-play"}),"Start Bot"]}),t.jsxs("span",{className:"flex items-center gap-1",children:[S&&t.jsx("span",{className:"bg-yellow-400 text-gray-900 text-[9px] font-bold px-1.5 py-0.5 rounded-full min-w-[16px] text-center shadow-sm",children:E}),M&&t.jsx("span",{className:"bg-red-500 text-white text-[9px] font-bold px-1.5 py-0.5 rounded-full min-w-[16px] text-center shadow-sm",children:v})]})]})})]})})}function i(){const[s,,r]=e("auth",{}),a=(null==s?void 0:s.user)||null,l=(null==s?void 0:s.session)||null,i=(null==s?void 0:s.isAuthenticated)||!(!a||!l);o.log(`Auth check - user: ${!!a}, session: ${!!l}, isAuthenticated: ${i}, isloading: ${r}`);const c=chrome.runtime.getURL("icons/icon16.png"),d=(e,s={})=>new Promise((t,r)=>{chrome.tabs.query({active:!0,currentWindow:!0},a=>{a[0]&&a[0].url&&a[0].url.includes("freelancer.com")?chrome.tabs.sendMessage(a[0].id,{action:e,...s},e=>{chrome.runtime.lastError?r(new Error("Content script not available. Please refresh the Freelancer.com page.")):t(e||{})}):r(new Error("Please navigate to Freelancer.com first."))})});return r?t.jsx("div",{className:"w-[360px] max-h-[600px] bg-dark-bg text-dark-text flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-dark-text-muted",children:"Loading..."})]})}):t.jsxs("div",{className:"w-[360px] max-h-[600px] bg-dark-bg text-dark-text flex flex-col",children:[t.jsxs("div",{className:"bg-dark-bg border-b border-dark-border px-4 py-2 sticky top-0 z-10 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2 flex-1",children:[t.jsx("img",{src:c,alt:"Icon",className:"w-4 h-4"}),t.jsx("h1",{className:"text-base font-semibold",children:"Freelancer Autobid"})]}),i&&t.jsx("button",{onClick:async()=>{try{const e=await d("showPanel",{tabName:"account"});if(e&&e.success)o.log("Panel shown successfully: account"),window.close();else{const s=(null==e?void 0:e.message)||"Failed to show panel. Make sure you are on Freelancer.com page.";o.error(`Failed to show panel: ${s}`),alert(s)}}catch(e){o.error(`Error showing panel: ${e.message||e}`),alert(e.message||"Failed to show panel. Please refresh the Freelancer.com page.")}},className:"flex items-center justify-center w-7 h-7 rounded-full bg-dark-card border border-dark-border hover:bg-dark-border hover:border-blue-500 transition-colors",title:"Account",children:t.jsx("i",{className:"fas fa-user-circle text-base text-dark-text"})})]}),t.jsx("p",{className:"text-[10px] text-dark-text-muted text-center mt-0.5",children:"v2.0.0 by Mern Master"})]}),t.jsx("div",{className:"flex-1 overflow-y-auto min-h-0 scrollbar-hide",children:i?t.jsx(n,{showPanelOnPage:async e=>{try{const s=await d("showPanel",{tabName:e});if(s&&s.success)o.log(`Panel shown successfully: ${e}`),window.close();else{const e=(null==s?void 0:s.message)||"Failed to show panel. Make sure you are on Freelancer.com page.";o.error(`Failed to show panel: ${e}`),alert(e)}}catch(s){o.error(`Error showing panel: ${s.message||s}`),alert(s.message||"Failed to show panel. Please refresh the Freelancer.com page.")}}}):t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6 text-center",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("i",{className:"fas fa-lock text-4xl text-gray-400 mb-3"}),t.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"Authentication Required"}),t.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Please login to use the Freelancer Autobid extension."})]}),t.jsxs("button",{onClick:async()=>{try{const e=await d("showPanel",{tabName:"login"});if(e&&e.success)o.log("Login modal shown successfully"),window.close();else{const s=(null==e?void 0:e.message)||"Failed to show login modal. Make sure you are on Freelancer.com page.";o.error(`Failed to show login modal: ${s}`),alert(s)}}catch(e){o.error(`Error showing login modal: ${e.message||e}`),alert(e.message||"Failed to show login modal. Please navigate to Freelancer.com and refresh the page.")}},className:"px-6 py-3 bg-blue-500 text-white rounded-md text-sm font-semibold hover:bg-blue-600 transition-colors",children:[t.jsx("i",{className:"fas fa-sign-in-alt mr-2"}),"Open Login"]}),t.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"Make sure you are on a Freelancer.com page"})]})})]})}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();r(document.getElementById("root")).render(t.jsx(a.StrictMode,{children:t.jsx(i,{})}));
